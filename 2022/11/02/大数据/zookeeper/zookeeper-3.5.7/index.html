<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yangmour.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="[TOC] 尚硅谷技术之 Zookeeper   （作者：尚硅谷研究院）  版本：V3.3  第 1 章 Zookeeper 入门1.1 概述Zookeeper 是一个开源的分布式的，为分布式框架提供协调服务的 Apache 项目。">
<meta property="og:type" content="article">
<meta property="og:title" content="zookeeper">
<meta property="og:url" content="https://yangmour.github.io/2022/11/02/%E5%A4%A7%E6%95%B0%E6%8D%AE/zookeeper/zookeeper-3.5.7/index.html">
<meta property="og:site_name" content="希文的个人博客">
<meta property="og:description" content="[TOC] 尚硅谷技术之 Zookeeper   （作者：尚硅谷研究院）  版本：V3.3  第 1 章 Zookeeper 入门1.1 概述Zookeeper 是一个开源的分布式的，为分布式框架提供协调服务的 Apache 项目。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://image.3001.net/images/20221102/16673997206641.png">
<meta property="og:image" content="https://image.3001.net/images/20221102/16673997427193.png">
<meta property="og:image" content="https://image.3001.net/images/20221102/16673997603200.png">
<meta property="og:image" content="https://image.3001.net/images/20221102/1667399826709.png">
<meta property="og:image" content="https://image.3001.net/images/20221101/16673103336222.gif">
<meta property="og:image" content="https://image.3001.net/images/20221101/16673103336273.gif">
<meta property="og:image" content="https://image.3001.net/images/20221102/1667400006134.png">
<meta property="og:image" content="https://image.3001.net/images/20221102/16674000294293.png">
<meta property="og:image" content="https://image.3001.net/images/20221102/16674000421122.png">
<meta property="og:image" content="https://image.3001.net/images/20221102/16674001078374.png">
<meta property="og:image" content="https://image.3001.net/images/20221102/16674002559289.png">
<meta property="og:image" content="https://image.3001.net/images/20221101/16673103336664.jpg">
<meta property="og:image" content="https://image.3001.net/images/20221101/16673103339937.jpg">
<meta property="og:image" content="https://image.3001.net/images/20221101/16673103337865.gif">
<meta property="og:image" content="https://image.3001.net/images/20221102/16674007565616.png">
<meta property="og:image" content="https://image.3001.net/images/20221102/16674009868131.png">
<meta property="og:image" content="https://image.3001.net/images/20221102/16674014294385.png">
<meta property="og:image" content="https://image.3001.net/images/20221102/16674014464410.png">
<meta property="og:image" content="https://image.3001.net/images/20221102/16674014814601.png">
<meta property="og:image" content="https://image.3001.net/images/20221102/1667401661884.png">
<meta property="og:image" content="https://image.3001.net/images/20221102/16674016864274.png">
<meta property="og:image" content="https://image.3001.net/images/20221102/16674017002867.png">
<meta property="og:image" content="https://image.3001.net/images/20221102/16674017343277.png">
<meta property="article:published_time" content="2022-11-02T15:06:17.000Z">
<meta property="article:modified_time" content="2022-11-02T15:24:30.057Z">
<meta property="article:author" content="希文">
<meta property="article:tag" content="hadoop">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image.3001.net/images/20221102/16673997206641.png">

<link rel="canonical" href="https://yangmour.github.io/2022/11/02/%E5%A4%A7%E6%95%B0%E6%8D%AE/zookeeper/zookeeper-3.5.7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>zookeeper | 希文的个人博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="希文的个人博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">希文的个人博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">白日依山尽，黄河入海流。欲穷千里目，更上一层楼。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签<span class="badge">16</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类<span class="badge">0</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档<span class="badge">50</span></a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="heartbeat fa-fw"></i>公益 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://yangmour.github.io/2022/11/02/%E5%A4%A7%E6%95%B0%E6%8D%AE/zookeeper/zookeeper-3.5.7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/%E5%A4%B4%E5%83%8F.gif">
      <meta itemprop="name" content="希文">
      <meta itemprop="description" content="日常笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="希文的个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          zookeeper
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-11-02 23:06:17 / 修改时间：23:24:30" itemprop="dateCreated datePublished" datetime="2022-11-02T23:06:17+08:00">2022-11-02</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>24k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>22 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>[TOC]</p>
<p>尚硅谷技术之 Zookeeper  </p>
<p>（作者：尚硅谷研究院） </p>
<p>版本：V3.3 </p>
<h1 id="第-1-章-Zookeeper-入门"><a href="#第-1-章-Zookeeper-入门" class="headerlink" title="第 1 章 Zookeeper 入门"></a>第 <strong>1</strong> 章 <strong>Zookeeper</strong> 入门</h1><h2 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1.1 概述"></a>1.1 概述</h2><p>Zookeeper 是一个开源的分布式的，为分布式框架提供协调服务的 Apache 项目。 </p>
<p><img src="https://image.3001.net/images/20221102/16673997206641.png" alt="image-20221102223508155"></p>
<span id="more"></span>

<p><img src="https://image.3001.net/images/20221102/16673997427193.png" alt="image-20221102223530801"></p>
<h2 id="1-2-特点"><a href="#1-2-特点" class="headerlink" title="1.2 特点"></a>1.2 特点</h2><p><img src="https://image.3001.net/images/20221102/16673997603200.png" alt="image-20221102223548537"></p>
<p>1）Zookeeper：一个领导者（Leader），多个跟随者（Follower）组成的集群。 </p>
<p>2）集群中只要有半数以上节点存活，Zookeeper集群就能正常服务。所 以Zookeeper适合安装奇数台服务器。 </p>
<p>3）全局数据一致：每个Server保存一份相同的数据副本，Client无论连接到哪个Server，数据都是一致的。</p>
<p>4）更新请求顺序执行，来自同一个Client的更新请求按其发送顺序依次执行。</p>
<p>5）数据更新原子性，一次数据更新要么成功，要么失败。 6）实时性，在一定时间范围内，Client能读到最新数据。</p>
<h2 id="1-3-数据结构"><a href="#1-3-数据结构" class="headerlink" title="1.3 数据结构"></a><strong>1.3</strong> 数据结构</h2><p>ZooKeeper 数据模型的结构与 Unix 文件系统很类似，整体上可以看作是一棵树，每个节点称做一个 ZNode。每一个 ZNode 默认能够存储 1MB 的数据，每个 ZNode 都可以通过其路径唯一标识。 </p>
<p><img src="https://image.3001.net/images/20221102/1667399826709.png" alt="image-20221102223654582"></p>
<h2 id="1-4-应用场景"><a href="#1-4-应用场景" class="headerlink" title="1.4 应用场景"></a>1.4 应用场景</h2><p>提供的服务包括：统一命名服务、统一配置管理、统一集群管理、服务器节点动态上下</p>
<p>线、软负载均衡等。</p>
<p><img src="https://image.3001.net/images/20221101/16673103336222.gif" alt="img"></p>
<p><img src="https://image.3001.net/images/20221101/16673103336273.gif" alt="img"></p>
<h2 id="1-5-下载地址"><a href="#1-5-下载地址" class="headerlink" title="1.5 下载地址"></a><strong>1.5</strong> 下载地址</h2><p><strong>1</strong>）官网首页：</p>
<p><a target="_blank" rel="noopener" href="https://zookeeper.apache.org/">https://zookeeper.apache.org/</a> </p>
<p>2）下载截图1</p>
<p><img src="https://image.3001.net/images/20221102/1667400006134.png" alt="image-20221102223954512"></p>
<p><img src="https://image.3001.net/images/20221102/16674000294293.png" alt="image-20221102224017707"></p>
<p><img src="https://image.3001.net/images/20221102/16674000421122.png" alt="image-20221102224031118"></p>
<p>3）下载 Linux 环境安装的 tar 包</p>
<p><img src="https://image.3001.net/images/20221102/16674001078374.png" alt="image-20221102224136026"></p>
<h1 id="第-2-章-Zookeeper-本地安装"><a href="#第-2-章-Zookeeper-本地安装" class="headerlink" title="第 2 章 Zookeeper 本地安装"></a>第 2 章 Zookeeper 本地安装</h1><h2 id="2-1-本地模式安装"><a href="#2-1-本地模式安装" class="headerlink" title="2.1 本地模式安装"></a><strong>2.1</strong> 本地模式安装</h2><p>1）安装前准备</p>
<p>（1）安装 JDK</p>
<p>（2）拷贝 apache-zookeeper-3.5.7-bin.tar.gz 安装包到 Linux 系统下</p>
<p>（3）解压到指定目录 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 software]$ tar -zxvf apache-zookeeper-3.5.7bin.tar.gz -C /opt/module/ </span><br></pre></td></tr></table></figure>

<p>（4）修改名称 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 module]$ mv apache-zookeeper-3.5.7 -bin/ zookeeper-3.5.7 </span><br></pre></td></tr></table></figure>

<p><strong>2）</strong>配置修改 </p>
<p>（1）将/opt/module/zookeeper-3.5.7/conf 这个路径下的 zoo_sample.cfg 修改为 zoo.cfg； </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 conf]$ mv zoo_sample.cfg zoo.cfg </span><br></pre></td></tr></table></figure>

<p>（2）打开 zoo.cfg 文件，修改 dataDir 路径：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 zookeeper-3.5.7]$ vim zoo.cfg </span><br></pre></td></tr></table></figure>

<p>修改如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataDir=/opt/module/zookeeper-3.5.7/zkData</span><br></pre></td></tr></table></figure>

<p>（3）在/opt/module/zookeeper-3.5.7/这个目录上创建 zkData 文件夹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 zookeeper-3.5.7]$ mkdir zkData </span><br></pre></td></tr></table></figure>

<p><strong>3）</strong>操作 <strong>Zookeeper</strong> </p>
<p>（1）启动 Zookeeper </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 zookeeper-3.5.7]$ bin/zkServer.sh start </span><br></pre></td></tr></table></figure>

<p>（2）查看进程是否启动 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 zookeeper-3.5.7]$ jps </span><br><span class="line">4020 Jps </span><br><span class="line">4001 QuorumPeerMain </span><br></pre></td></tr></table></figure>

<p>（3）查看状态 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 zookeeper-3.5.7]$ bin/zkServer.sh status </span><br><span class="line">ZooKeeper JMX enabled by default </span><br><span class="line">Using config: /opt/module/zookeeper-3.5.7/bin/../conf/zoo.cfg</span><br><span class="line">Mode: standalone </span><br></pre></td></tr></table></figure>

<p>（4）启动客户端 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 zookeeper-3.5.7]$ bin/zkCli.sh </span><br></pre></td></tr></table></figure>

<p>（5）退出客户端： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 0] quit </span><br></pre></td></tr></table></figure>

<p>（6）停止 Zookeeper </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 zookeeper-3.5.7]$ bin/zkServer.sh stop </span><br></pre></td></tr></table></figure>

<h2 id="2-2-配置参数解读"><a href="#2-2-配置参数解读" class="headerlink" title="2.2 配置参数解读"></a><strong>2.2</strong> 配置参数解读</h2><p>​    Zookeeper中的配置文件zoo.cfg中参数含义解读如下：</p>
<p><strong>1</strong>）<strong>tickTime = 2000</strong>：通信心跳时间，<strong>Zookeeper</strong>服务器与客户端心跳时间，单位毫秒 </p>
<p><img src="https://image.3001.net/images/20221102/16674002559289.png" alt="image-20221102224404090"></p>
<p>2）initLimit = 10：LF初始通信时限</p>
<p><img src="https://image.3001.net/images/20221101/16673103336664.jpg" alt="img"> </p>
<p>Leader和Follower初始连接时能容忍的最多心跳数（tickTime的数量）</p>
<p><strong>3）</strong> <strong>syncLimit = 5</strong>：<strong>LF</strong>同步通信时限 </p>
<p><img src="https://image.3001.net/images/20221101/16673103339937.jpg" alt="img"> </p>
<p>​    Leader和Follower之间通信时间如果超过syncLimit * tickTime，Leader认为Follwer死</p>
<p>掉，从服务器列表中删除Follwer。 </p>
<p><strong>4）</strong> <strong>dataDir</strong>：保存Zookeeper中的数据</p>
<p>​    注意：默认的tmp目录，容易被Linux系统定期删除，所以一般不用默认的tmp目录。 </p>
<p><strong>5）</strong> <strong>clientPort = 2181</strong>：客户端连接端口，通常不做修改。</p>
<h1 id="第-3-章-Zookeeper-集群操作"><a href="#第-3-章-Zookeeper-集群操作" class="headerlink" title="第 3 章 Zookeeper 集群操作"></a>第 <strong>3</strong> 章 <strong>Zookeeper</strong> 集群操作</h1><h2 id="3-1-集群操作"><a href="#3-1-集群操作" class="headerlink" title="3.1 集群操作"></a><strong>3.1</strong> 集群操作</h2><h3 id="3-1-1-集群安装"><a href="#3-1-1-集群安装" class="headerlink" title="3.1.1 集群安装"></a><strong>3.1.1</strong> 集群安装</h3><p><strong>1）</strong>集群规划 </p>
<p>​    在 hadoop102、hadoop103 和 hadoop104 三个节点上都部署 Zookeeper。 </p>
<p>​    思考：如果是<em>10</em> 台服务器，需要部署多少台<em>Zookeeper</em>？ </p>
<p><strong>2）</strong>解压安装 </p>
<p>（1）在 hadoop102 解压 Zookeeper 安装包到/opt/module/目录下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 software]$ tar -zxvf apache-zookeeper-3.5.7bin.tar.gz -C /opt/module/ </span><br></pre></td></tr></table></figure>

<p>（2）修改 apache-zookeeper-3.5.7-bin 名称为 zookeeper-3.5.7 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 module]$ mv apache-zookeeper-3.5.7-bin/ zookeeper-3.5.7 </span><br></pre></td></tr></table></figure>

<p><strong>3）</strong>配置服务器编号 </p>
<p>（1）在/opt/module/zookeeper-3.5.7/这个目录下创建 zkData</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 zookeeper-3.5.7]$ mkdir zkData </span><br></pre></td></tr></table></figure>

<p>（2）在/opt/module/zookeeper-3.5.7/zkData 目录下创建一个 myid 的文件 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 zkData]$ vi myid</span><br></pre></td></tr></table></figure>

<p>在文件中添加与 server 对应的编号（注意：上下不要有空行，左右不要有空格）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2 </span><br></pre></td></tr></table></figure>

<p>注意：添加 myid 文件，一定要在 Linux 里面创建，在 notepad++里面很可能乱码 </p>
<p>（3）拷贝配置好的 zookeeper 到其他机器上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 module ]$ xsync zookeeper-3.5.7 </span><br></pre></td></tr></table></figure>

<p>并分别在 hadoop103、hadoop104 上修改 myid 文件中内容为 3、4 </p>
<p><strong>4）</strong>配置<strong>zoo.cfg</strong>文件 （我用的cp 复制）</p>
<p>（1）重命名/opt/module/zookeeper-3.5.7/conf 这个目录下的 zoo_sample.cfg 为 zoo.cfg </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 conf]$ mv zoo_sample.cfg zoo.cfg </span><br></pre></td></tr></table></figure>

<p>（2）打开 zoo.cfg 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 conf]$ vim zoo.cfg</span><br></pre></td></tr></table></figure>

<p>#修改数据存储路径配置 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataDir=/opt/module/zookeeper-3.5.7/zkData</span><br></pre></td></tr></table></figure>

<p>#增加如下配置 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#######################cluster########################## server.2=hadoop102:2888:3888 server.3=hadoop103:2888:3888 server.4=hadoop104:2888:3888 </span><br></pre></td></tr></table></figure>

<p>（3）配置参数解读</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.A=B:C:D。 </span><br></pre></td></tr></table></figure>

<p><strong>A</strong>    是一个数字，表示这个是第几号服务器；集群模式下配置一个文件 myid，这个文件在 dataDir 目录下，这个文件里面有一个数据就是 A 的值，Zookeeper 启动时读取此文件，拿到里面的数据与 zoo.cfg 里面的配置信息比较从而判断到底是哪个 server。 </p>
<p><strong>B</strong>    是这个服务器的地址； </p>
<p><strong>C</strong>    是这个服务器 Follower 与集群中的 Leader 服务器交换信息的端口；</p>
<p><strong>D</strong>    是万一集群中的 Leader 服务器挂了，需要一个端口来重新进行选举，选出一个新的Leader，而这个端口就是用来执行选举时服务器相互通信的端口。 </p>
<p>（4）同步 zoo.cfg 配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 conf]$ xsync zoo.cfg </span><br></pre></td></tr></table></figure>

<p><strong>5）</strong>集群操作 </p>
<p>（1）分别启动 Zookeeper</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 zookeeper-3.5.7]$ bin/zkServer.sh start </span><br><span class="line">[atguigu@hadoop103 zookeeper-3.5.7]$ bin/zkServer.sh start </span><br><span class="line">[atguigu@hadoop104 zookeeper-3.5.7]$ bin/zkServer.sh start </span><br></pre></td></tr></table></figure>

<p>（2）查看状态</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 zookeeper-3.5.7]# bin/zkServer.sh status </span><br><span class="line">JMX enabled by default </span><br><span class="line">Using config: /opt/module/zookeeper-3.5.7/bin/../conf/zoo.cfg</span><br><span class="line">Mode: follower </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop103 zookeeper-3.5.7]# bin/zkServer.sh status </span><br><span class="line">JMX enabled by default </span><br><span class="line">Using config: /opt/module/zookeeper-3.5.7/bin/../conf/zoo.cfg </span><br><span class="line">Mode: leader </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop104 zookeeper-3.4.5]# bin/zkServer.sh status </span><br><span class="line">JMX enabled by default </span><br><span class="line">Using config: /opt/module/zookeeper-3.5.7/bin/../conf/zoo.cfg Mode: follower </span><br></pre></td></tr></table></figure>



<h3 id="3-1-2-选举机制（面试重点）"><a href="#3-1-2-选举机制（面试重点）" class="headerlink" title="3.1.2 选举机制（面试重点）"></a><strong>3.1.2</strong> 选举机制（面试重点）</h3><p><img src="https://image.3001.net/images/20221101/16673103337865.gif" alt="img"></p>
<h3 id="3-1-3-ZK-集群启动停止脚本"><a href="#3-1-3-ZK-集群启动停止脚本" class="headerlink" title="3.1.3 ZK 集群启动停止脚本"></a><strong>3.1.3 ZK</strong> 集群启动停止脚本</h3><p>1）在 hadoop102 的/home/atguigu/bin 目录下创建脚本 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 bin]$ vim zk.sh</span><br></pre></td></tr></table></figure>

<p> 在脚本中编写如下内容 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">&quot;start&quot;)&#123;</span><br><span class="line">	for i in hadoop102 hadoop103 hadoop104</span><br><span class="line">	do</span><br><span class="line"> 		echo ---------- zookeeper $i 启动 ------------</span><br><span class="line">		ssh $i &quot;/opt/module/zookeeper-3.5.7/bin/zkServer.sh start&quot;</span><br><span class="line">	done</span><br><span class="line">&#125;;;</span><br><span class="line">&quot;stop&quot;)&#123;</span><br><span class="line">	for i in hadoop102 hadoop103 hadoop104</span><br><span class="line">	do</span><br><span class="line"> 		echo ---------- zookeeper $i 停止 ------------</span><br><span class="line">		ssh $i &quot;/opt/module/zookeeper-3.5.7/bin/zkServer.sh stop&quot;</span><br><span class="line">	done</span><br><span class="line">&#125;;;</span><br><span class="line">&quot;status&quot;)&#123;</span><br><span class="line">	for i in hadoop102 hadoop103 hadoop104</span><br><span class="line">	do</span><br><span class="line">		 echo ---------- zookeeper $i 状态 ------------</span><br><span class="line">		ssh $i &quot;/opt/module/zookeeper-3.5.7/bin/zkServer.sh status&quot;</span><br><span class="line">	done</span><br><span class="line">&#125;;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<p>2）增加脚本执行权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 bin]$ chmod u+x zk.sh </span><br></pre></td></tr></table></figure>

<p>3）Zookeeper 集群启动脚本 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 module]$ zk.sh start </span><br></pre></td></tr></table></figure>

<p>4）Zookeeper 集群停止脚本 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 module]$ zk.sh stop </span><br></pre></td></tr></table></figure>

<h2 id="3-2-客户端命令行操作"><a href="#3-2-客户端命令行操作" class="headerlink" title="3.2 客户端命令行操作"></a><strong>3.2</strong> 客户端命令行操作</h2><h3 id="3-2-1-命令行语法"><a href="#3-2-1-命令行语法" class="headerlink" title="3.2.1 命令行语法"></a><strong>3.2.1</strong> 命令行语法</h3><table>
<thead>
<tr>
<th>命令基本语法</th>
<th>功能描述</th>
</tr>
</thead>
<tbody><tr>
<td>help</td>
<td>显示所有操作命令</td>
</tr>
<tr>
<td>ls path</td>
<td>使用 ls 命令来查看当前 znode 的子节点 [可监听]   -w 监听子节点变化   -s  附加次级信息</td>
</tr>
<tr>
<td>create</td>
<td>普通创建   -s 含有序列   -e 临时（重启或者超时消失）</td>
</tr>
<tr>
<td>get path</td>
<td>获得节点的值 [可监听]   -w 监听节点内容变化   -s  附加次级信息</td>
</tr>
<tr>
<td>set</td>
<td>设置节点的具体值</td>
</tr>
<tr>
<td>stat</td>
<td>查看节点状态</td>
</tr>
<tr>
<td>delete</td>
<td>删除节点</td>
</tr>
<tr>
<td>deleteall</td>
<td>递归删除节点</td>
</tr>
</tbody></table>
<p><strong>1）</strong>启动客户端 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 zookeeper-3.5.7]$ bin/zkCli.sh -server hadoop102:2181</span><br></pre></td></tr></table></figure>

<p><strong>2）</strong>显示所有操作命令 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: hadoop102:2181(CONNECTED) 1] help </span><br></pre></td></tr></table></figure>

<h3 id="3-2-2-znode-节点数据信息"><a href="#3-2-2-znode-节点数据信息" class="headerlink" title="3.2.2 znode 节点数据信息"></a><strong>3.2.2 znode</strong> 节点数据信息</h3><p><strong>1）</strong>查看当前<strong>znode</strong>中所包含的内容 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: hadoop102:2181(CONNECTED) 0] ls / </span><br><span class="line">[zookeeper] </span><br></pre></td></tr></table></figure>

<p><strong>2）</strong>查看当前节点详细数据 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[zk: hadoop102:2181(CONNECTED) 5] ls -s /</span><br><span class="line">[zookeeper]cZxid = 0x0</span><br><span class="line">ctime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">mZxid = 0x0</span><br><span class="line">mtime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">pZxid = 0x0</span><br><span class="line">cversion = -1</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 0</span><br><span class="line">numChildren = 1</span><br></pre></td></tr></table></figure>

<p>（1）   czxid：创建节点的事务 zxid 每次修改 ZooKeeper 状态都会产生一个 ZooKeeper 事务 ID。事务 ID 是 ZooKeeper 中所有修改总的次序。每次修改都有唯一的 zxid，如果 zxid1 小于 zxid2，那么 zxid1 在 zxid2 之前发生。 </p>
<p>（2）   ctime：znode 被创建的毫秒数（从 1970 年开始）</p>
<p>（3）   mzxid：znode 最后更新的事务 zxid </p>
<p>（4）   mtime：znode 最后修改的毫秒数（从 1970 年开始）</p>
<p>（5）   pZxid：znode 最后更新的子节点 zxid </p>
<p>（6）   cversion：znode 子节点变化号，znode 子节点修改次数</p>
<p>（7）   dataversion：znode 数据变化号 </p>
<p>（8）   aclVersion：znode 访问控制列表的变化号 </p>
<p>（9）   ephemeralOwner：如果是临时节点，这个是 znode 拥有者的 session id。如果不是临时节点则是 0。 </p>
<p>（10）  dataLength：znode 的数据长度 </p>
<p>（11）  numChildren：znode 子节点数量 </p>
<h3 id="3-2-3-节点类型（持久-短暂-有序号-无序号）"><a href="#3-2-3-节点类型（持久-短暂-有序号-无序号）" class="headerlink" title="3.2.3 节点类型（持久**/短暂/有序号/**无序号）"></a><strong>3.2.3</strong> 节点类型（持久**/<strong>短暂</strong>/<strong>有序号</strong>/**无序号）</h3><p><img src="https://image.3001.net/images/20221102/16674007565616.png" alt="image-20221102225224799"></p>
<p><strong>1）</strong>分别创建<strong>2</strong>个普通节点（永久节点 <strong>+</strong> 不带序号） </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 3] create /sanguo &quot;diaochan&quot; </span><br><span class="line">Created /sanguo </span><br><span class="line"></span><br><span class="line">[zk: localhost:2181(CONNECTED) 4] create /sanguo/shuguo &quot;liubei&quot; </span><br><span class="line">Created /sanguo/shuguo </span><br></pre></td></tr></table></figure>

<p> 注意：创建节点时，要赋值 </p>
<p><strong>2）</strong>获得节点的值 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 5] get -s /sanguo</span><br><span class="line">diaochan</span><br><span class="line">cZxid = 0x100000003</span><br><span class="line">ctime = Wed Aug 29 00:03:23 CST 2018</span><br><span class="line">mZxid = 0x100000003</span><br><span class="line">mtime = Wed Aug 29 00:03:23 CST 2018</span><br><span class="line">pZxid = 0x100000004</span><br><span class="line">cversion = 1</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 7</span><br><span class="line">numChildren = 1</span><br><span class="line"></span><br><span class="line">[zk: localhost:2181(CONNECTED) 6] get -s /sanguo/shuguo</span><br><span class="line">liubei</span><br><span class="line">cZxid = 0x100000004</span><br><span class="line">ctime = Wed Aug 29 00:04:35 CST 2018</span><br><span class="line">mZxid = 0x100000004</span><br><span class="line">mtime = Wed Aug 29 00:04:35 CST 2018</span><br><span class="line">pZxid = 0x100000004</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 6</span><br><span class="line">numChildren = 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>3）</strong>创建带序号的节点（永久节点 <strong>+</strong> 带序号） </p>
<p>（1）先创建一个普通的根节点/sanguo/weiguo </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 1] create /sanguo/weiguo &quot;caocao&quot; </span><br><span class="line">Created /sanguo/weiguo </span><br></pre></td></tr></table></figure>

<p>（2）创建带序号的节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 2] create -s /sanguo/weiguo/zhangliao &quot;zhangliao&quot;</span><br><span class="line">Created /sanguo/weiguo/zhangliao0000000000</span><br><span class="line"></span><br><span class="line">[zk: localhost:2181(CONNECTED) 3] create -s /sanguo/weiguo/zhangliao &quot;zhangliao&quot;</span><br><span class="line">Created /sanguo/weiguo/zhangliao0000000001</span><br><span class="line"></span><br><span class="line">[zk: localhost:2181(CONNECTED) 4] create -s /sanguo/weiguo/xuchu &quot;xuchu&quot;</span><br><span class="line">Created /sanguo/weiguo/xuchu0000000002</span><br></pre></td></tr></table></figure>

<p>如果原来没有序号节点，序号从 0 开始依次递增。如果原节点下已有 2 个节点，则再排序时从 2 开始，以此类推。</p>
<p><strong>4）</strong>创建短暂节点（短暂节点 <strong>+</strong> 不带序号 <strong>or</strong> 带序号） </p>
<p>（1）创建短暂的不带序号的节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 7] create -e /sanguo/wuguo &quot;zhouyu&quot; </span><br><span class="line">Created /sanguo/wuguo </span><br></pre></td></tr></table></figure>

<p>（2）创建短暂的带序号的节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 2] create -e -s /sanguo/wuguo &quot;zhouyu&quot; </span><br><span class="line">Created /sanguo/wuguo0000000001 </span><br></pre></td></tr></table></figure>

<p>（3）在当前客户端是能查看到的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 3] ls /sanguo</span><br><span class="line">[wuguo, wuguo0000000001, shuguo] </span><br></pre></td></tr></table></figure>

<p>（4）退出当前客户端然后再重启客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 12] quit </span><br><span class="line">[atguigu@hadoop104 zookeeper-3.5.7]$ bin/zkCli.sh </span><br></pre></td></tr></table></figure>

<p>（5）再次查看根目录下短暂节点已经删除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 0] ls /sanguo </span><br><span class="line">[shuguo] </span><br></pre></td></tr></table></figure>

<p><strong>5）</strong>修改节点数据值 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 6] set /sanguo/weiguo &quot;simayi&quot; </span><br></pre></td></tr></table></figure>

<h3 id="3-2-4-监听器原理"><a href="#3-2-4-监听器原理" class="headerlink" title="3.2.4 监听器原理"></a><strong>3.2.4</strong> 监听器原理</h3><p>客户端注册监听它关心的目录节点，当目录节点发生变化（数据改变、节点删除、子目录节点增加删除）时，ZooKeeper 会通知客户端。监听机制保证 ZooKeeper 保存的任何的数</p>
<p>据的任何改变都能快速的响应到监听了该节点的应用程序。</p>
<p><img src="https://image.3001.net/images/20221102/16674009868131.png" alt="image-20221102225614958"></p>
<p><strong>1）</strong>节点的值变化监听 </p>
<p>（1）在 hadoop104 主机上注册监听/sanguo 节点数据变化 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 26] get -w /sanguo </span><br></pre></td></tr></table></figure>

<p>（2）在 hadoop103 主机上修改/sanguo 节点的数据 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 1] set /sanguo &quot;xisi&quot; </span><br></pre></td></tr></table></figure>

<p>（3）观察 hadoop104 主机收到数据变化的监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WATCHER::</span><br><span class="line">WatchedEvent state:SyncConnected type:NodeDataChanged path:/sanguo</span><br></pre></td></tr></table></figure>

<p> 注意：在hadoop103再多次修改/sanguo的值，hadoop104上不会再收到监听。因为注册</p>
<p>一次，只能监听一次。想再次监听，需要再次注册。 </p>
<p><strong>2）</strong>节点的子节点变化监听（路径变化） </p>
<p>（1）在 hadoop104 主机上注册监听/sanguo 节点的子节点变化 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 1] ls -w /sanguo </span><br><span class="line">[shuguo, weiguo] </span><br></pre></td></tr></table></figure>

<p>（2）在 hadoop103 主机/sanguo 节点上创建子节点 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 2] create /sanguo/jin &quot;simayi&quot; </span><br><span class="line">Created /sanguo/jin </span><br></pre></td></tr></table></figure>

<p>（3）观察 hadoop104 主机收到子节点变化的监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WATCHER:: </span><br><span class="line">WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/sanguo </span><br></pre></td></tr></table></figure>

<p>注意：节点的路径变化，也是注册一次，生效一次。想多次生效，就需要多次注册。 </p>
<h3 id="3-2-5-节点删除与查看"><a href="#3-2-5-节点删除与查看" class="headerlink" title="3.2.5 节点删除与查看"></a><strong>3.2.5</strong> 节点删除与查看</h3><p><strong>1）</strong>删除节点 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 4] delete /sanguo/jin </span><br></pre></td></tr></table></figure>

<p><strong>2）</strong>递归删除节点 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 15] deleteall /sanguo/shuguo </span><br></pre></td></tr></table></figure>

<p><strong>3）</strong>查看节点状态 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 17] stat /sanguo</span><br><span class="line">cZxid = 0x100000003</span><br><span class="line">ctime = Wed Aug 29 00:03:23 CST 2018</span><br><span class="line">mZxid = 0x100000011</span><br><span class="line">mtime = Wed Aug 29 00:21:23 CST 2018</span><br><span class="line">pZxid = 0x100000014</span><br><span class="line">cversion = 9</span><br><span class="line">dataVersion = 1</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 4</span><br><span class="line">numChildren = 1</span><br></pre></td></tr></table></figure>



<h2 id="3-3-客户端-API-操作"><a href="#3-3-客户端-API-操作" class="headerlink" title="3.3 客户端 API 操作"></a>3.3 客户端 API 操作</h2><p>前提：保证 hadoop102、hadoop103、hadoop104 服务器上 Zookeeper 集群服务端启动。 </p>
<h3 id="3-3-1-IDEA-环境搭建"><a href="#3-3-1-IDEA-环境搭建" class="headerlink" title="3.3.1 IDEA 环境搭建"></a><strong>3.3.1 IDEA</strong> 环境搭建</h3><p><strong>1）</strong>创建一个工程：<strong>zookeeper</strong> </p>
<p><strong>2）</strong>添加<strong>pom</strong>文件 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.8.2&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;3.5.7&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<p><strong>3）</strong>拷贝<strong>log4j.properties</strong>文件到项目根目录需要在项目的 src/main/resources 目录下，新建一个文件，命名为“log4j.properties”，在</p>
<p>文件中填入。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">INFO, stdout</span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d %p [%c] - %m%n</span></span><br><span class="line"><span class="meta">log4j.appender.logfile</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="meta">log4j.appender.logfile.File</span>=<span class="string">target/spring.log</span></span><br><span class="line"><span class="meta">log4j.appender.logfile.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.logfile.layout.ConversionPattern</span>=<span class="string">%d %p [%c] - %m%n </span></span><br></pre></td></tr></table></figure>

<p><strong>4）</strong>创建包名<strong>com.atguigu.zk</strong> </p>
<p><strong>5）</strong>创建类名称<strong>zkClient</strong> </p>
<h3 id="3-3-2-创建-ZooKeeper-客户端"><a href="#3-3-2-创建-ZooKeeper-客户端" class="headerlink" title="3.3.2 创建 ZooKeeper 客户端"></a><strong>3.3.2</strong> 创建 <strong>ZooKeeper</strong> 客户端</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// 注意：逗号前后不能有空格 </span><br><span class="line">    private static String connectString =</span><br><span class="line">            &quot;hadoop102:2181,hadoop103:2181,hadoop104:2181&quot;;</span><br><span class="line"></span><br><span class="line">    private static int sessionTimeout = 2000;</span><br><span class="line">    private ZooKeeper zkClient = null;</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    public void init() throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        zkClient = new ZooKeeper(connectString, sessionTimeout, new Watcher() &#123;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void process(WatchedEvent watchedEvent) &#123;</span><br><span class="line">                // 收到事件通知后的回调函数（用户的业务逻辑） </span><br><span class="line">                System.out.println(watchedEvent.getType() + &quot;--&quot; + watchedEvent.getPath());</span><br><span class="line"></span><br><span class="line">                // 再次启动监听 </span><br><span class="line">                try &#123;</span><br><span class="line">                    List&lt;String&gt; children = zkClient.getChildren(&quot;/&quot;, true);</span><br><span class="line">                    for (String child : children) &#123;</span><br><span class="line">                        System.out.println(child);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-3-3-创建子节点"><a href="#3-3-3-创建子节点" class="headerlink" title="3.3.3 创建子节点"></a><strong>3.3.3</strong> 创建子节点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 创建子节点</span><br><span class="line">@Test</span><br><span class="line">public void create() throws Exception &#123;</span><br><span class="line">    // 参数 1：要创建的节点的路径； 参数 2：节点数据 ； 参数 3：节点权限 ；</span><br><span class="line">    参数 4：节点的类型</span><br><span class="line">    String nodeCreated = zkClient.create(&quot;/atguigu&quot;,</span><br><span class="line">    &quot;shuaige&quot;.getBytes(), Ids.OPEN_ACL_UNSAFE,</span><br><span class="line">    CreateMode.PERSISTENT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：在 hadoop102 的 zk 客户端上查看创建节点情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 16] get -s /atguigu</span><br><span class="line">shuaige</span><br></pre></td></tr></table></figure>



<h3 id="3-3-4-获取子节点并监听节点变化"><a href="#3-3-4-获取子节点并监听节点变化" class="headerlink" title="3.3.4 获取子节点并监听节点变化"></a><strong>3.3.4</strong> 获取子节点并监听节点变化</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 获取子节点</span><br><span class="line">@Test</span><br><span class="line">public void getChildren() throws Exception &#123;</span><br><span class="line">    List&lt;String&gt; children = zkClient.getChildren(&quot;/&quot;, true);</span><br><span class="line">    for (String child : children) &#123;</span><br><span class="line">        System.out.println(child);</span><br><span class="line">    &#125;</span><br><span class="line">    // 延时阻塞</span><br><span class="line">    Thread.sleep(Long.MAX_VALUE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>（1）在 IDEA 控制台上看到如下节点： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zookeeper </span><br><span class="line">sanguo </span><br><span class="line">atguigu </span><br></pre></td></tr></table></figure>

<p>（2）在 hadoop102 的客户端上创建再创建一个节点/atguigu1，观察 IDEA 控制台 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 3] create /atguigu1 &quot;atguigu1&quot; </span><br></pre></td></tr></table></figure>

<p>（3）在 hadoop102 的客户端上删除节点/atguigu1，观察 IDEA 控制台 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 4] delete /atguigu1  </span><br></pre></td></tr></table></figure>

<h3 id="3-3-5-判断-Znode-是否存在"><a href="#3-3-5-判断-Znode-是否存在" class="headerlink" title="3.3.5 判断 Znode 是否存在"></a><strong>3.3.5</strong> 判断 <strong>Znode</strong> 是否存在</h3><p>// 判断znode是否存在 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 获取子节点</span><br><span class="line">@Test</span><br><span class="line">public void getChildren() throws Exception &#123;</span><br><span class="line">    List&lt;String&gt; children = zkClient.getChildren(&quot;/&quot;, true);</span><br><span class="line">    for (String child : children) &#123;</span><br><span class="line">    	System.out.println(child);</span><br><span class="line">    &#125;</span><br><span class="line">    // 延时阻塞</span><br><span class="line">    Thread.sleep(Long.MAX_VALUE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="3-4-客户端向服务端写数据流程"><a href="#3-4-客户端向服务端写数据流程" class="headerlink" title="3.4 客户端向服务端写数据流程"></a><strong>3.4</strong> 客户端向服务端写数据流程</h2><p><img src="https://image.3001.net/images/20221102/16674014294385.png" alt="image-20221102230338175"></p>
<p><img src="https://image.3001.net/images/20221102/16674014464410.png" alt="image-20221102230354944"></p>
<h1 id="第-4-章-服务器动态上下线监听案例"><a href="#第-4-章-服务器动态上下线监听案例" class="headerlink" title="第 4 章 服务器动态上下线监听案例"></a>第 4 章 服务器动态上下线监听案例</h1><h2 id="4-1-需求"><a href="#4-1-需求" class="headerlink" title="4.1 需求"></a><strong>4.1</strong> 需求</h2><p>某分布式系统中，主节点可以有多台，可以动态上下线，任意一台客户端都能实时感知</p>
<p>到主节点服务器的上下线。</p>
<h2 id="4-2-需求分析"><a href="#4-2-需求分析" class="headerlink" title="4.2 需求分析"></a><strong>4.2</strong> 需求分析</h2><p><img src="https://image.3001.net/images/20221102/16674014814601.png" alt="image-20221102230430332"></p>
<h2 id="4-3-具体实现"><a href="#4-3-具体实现" class="headerlink" title="4.3 具体实现"></a><strong>4.3</strong> 具体实现</h2><p>（1）先在集群上创建/servers 节点 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 10] create /servers &quot;servers&quot;</span><br><span class="line">Created /servers </span><br></pre></td></tr></table></figure>

<p>（2）在 Idea 中创建包名：com.atguigu.zkcase1</p>
<p>（3）服务器端向 Zookeeper 注册代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.zkcase1;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">import org.apache.zookeeper.CreateMode;</span><br><span class="line">import org.apache.zookeeper.WatchedEvent;</span><br><span class="line">import org.apache.zookeeper.Watcher;</span><br><span class="line">import org.apache.zookeeper.ZooKeeper;</span><br><span class="line">import org.apache.zookeeper.ZooDefs.Ids;</span><br><span class="line"></span><br><span class="line">public class DistributeServer &#123;</span><br><span class="line">    private static String connectString =</span><br><span class="line">            &quot;hadoop102:2181,hadoop103:2181,hadoop104:2181&quot;;</span><br><span class="line">    private static int sessionTimeout = 2000;</span><br><span class="line">    private ZooKeeper zk = null;</span><br><span class="line">    private String parentNode = &quot;/servers&quot;;</span><br><span class="line"></span><br><span class="line">    // 创建到 zk 的客户端连接</span><br><span class="line">    public void getConnect() throws IOException &#123;</span><br><span class="line">        zk = new ZooKeeper(connectString, sessionTimeout, new</span><br><span class="line">                Watcher() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    public void process(WatchedEvent event) &#123;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 注册服务器</span><br><span class="line">    public void registServer(String hostname) throws Exception &#123;</span><br><span class="line">        String create = zk.create(parentNode + &quot;/server&quot;,</span><br><span class="line">                hostname.getBytes(), Ids.OPEN_ACL_UNSAFE,</span><br><span class="line">                CreateMode.EPHEMERAL_SEQUENTIAL);</span><br><span class="line">        System.out.println(hostname + &quot; is online &quot; + create);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 业务功能</span><br><span class="line">    public void business(String hostname) throws Exception &#123;</span><br><span class="line">        System.out.println(hostname + &quot; is working ...&quot;);</span><br><span class="line">        Thread.sleep(Long.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">// 1 获取 zk 连接</span><br><span class="line">        DistributeServer server = new DistributeServer();</span><br><span class="line">        server.getConnect();</span><br><span class="line">// 2 利用 zk 连接注册服务器信息</span><br><span class="line">        server.registServer(args[0]);</span><br><span class="line">// 3 启动业务功能</span><br><span class="line">        server.business(args[0]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3）客户端代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.zkcase1;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import org.apache.zookeeper.WatchedEvent;</span><br><span class="line">import org.apache.zookeeper.Watcher;</span><br><span class="line">import org.apache.zookeeper.ZooKeeper;</span><br><span class="line"></span><br><span class="line">public class DistributeClient &#123;</span><br><span class="line">    private static String connectString =</span><br><span class="line">            &quot;hadoop102:2181,hadoop103:2181,hadoop104:2181&quot;;</span><br><span class="line">    private static int sessionTimeout = 2000;</span><br><span class="line">    private ZooKeeper zk = null;</span><br><span class="line">    private String parentNode = &quot;/servers&quot;;</span><br><span class="line"></span><br><span class="line">    // 创建到 zk 的客户端连接</span><br><span class="line">    public void getConnect() throws IOException &#123;</span><br><span class="line">        zk = new ZooKeeper(connectString, sessionTimeout, new</span><br><span class="line">                Watcher() &#123;</span><br><span class="line"></span><br><span class="line">                    @Override</span><br><span class="line">                    public void process(WatchedEvent event) &#123;</span><br><span class="line">// 再次启动监听</span><br><span class="line">                        try &#123;</span><br><span class="line">                            getServerList();</span><br><span class="line">                        &#125; catch (Exception e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 获取服务器列表信息</span><br><span class="line">    public void getServerList() throws Exception &#123;</span><br><span class="line">        // 1 获取服务器子节点信息，并且对父节点进行监听</span><br><span class="line">        List&lt;String&gt; children = zk.getChildren(parentNode, true);</span><br><span class="line">        // 2 存储服务器信息列表</span><br><span class="line">        ArrayList&lt;String&gt; servers = new ArrayList&lt;&gt;();</span><br><span class="line">        // 3 遍历所有节点，获取节点中的主机名称信息</span><br><span class="line">        for (String child : children) &#123;</span><br><span class="line">            byte[] data = zk.getData(parentNode + &quot;/&quot; + child,</span><br><span class="line">                    false, null);</span><br><span class="line">            servers.add(new String(data));</span><br><span class="line">        &#125;</span><br><span class="line">        // 4 打印服务器列表信息</span><br><span class="line">        System.out.println(servers);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 业务功能</span><br><span class="line">    public void business() throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;client is working ...&quot;);</span><br><span class="line">        Thread.sleep(Long.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">// 1 获取 zk 连接</span><br><span class="line">        DistributeClient client = new DistributeClient();</span><br><span class="line">        client.getConnect();</span><br><span class="line">// 2 获取 servers 的子节点信息，从中获取服务器信息列表</span><br><span class="line">        client.getServerList();</span><br><span class="line">// 3 业务进程启动</span><br><span class="line">        client.business();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="4-4-测试"><a href="#4-4-测试" class="headerlink" title="4.4 测试"></a><strong>4.4</strong> 测试</h2><p>1）在 Linux 命令行上操作增加减少服务器</p>
<p>（1）启动 DistributeClient 客户端</p>
<p>（2）在 hadoop102 上 zk 的客户端/servers 目录上创建临时带序号节点 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 1] create -e -s /servers/hadoop102 &quot;hadoop102&quot;</span><br><span class="line">[zk: localhost:2181(CONNECTED) 2] create -e -s /servers/hadoop103 &quot;hadoop103&quot;</span><br></pre></td></tr></table></figure>

<p>（3）观察 Idea 控制台变化 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hadoop102, hadoop103] </span><br></pre></td></tr></table></figure>

<p>（4）执行删除操作 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 8] delete /servers/hadoop1020000000000</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>（5）观察 Idea 控制台变化 </p>
<p>[hadoop103] </p>
<p>2）在 Idea 上操作增加减少服务器</p>
<p>（1）启动 DistributeClient 客户端（如果已经启动过，不需要重启）</p>
<p>（2）启动 DistributeServer 服务 </p>
<p>①点击 Edit Configurations…</p>
<p><img src="https://image.3001.net/images/20221102/1667401661884.png" alt="image-20221102230729779"></p>
<p> ②在弹出的窗口中（Program arguments）输入想启动的主机，例如，hadoop102 </p>
<p><img src="https://image.3001.net/images/20221102/16674016864274.png" alt="image-20221102230754787"></p>
<p> ③回到 DistributeServer 的 main 方法，右键，在弹出的窗口中点击 Run </p>
<p>“DistributeServer.main()”</p>
<p><img src="https://image.3001.net/images/20221102/16674017002867.png" alt="image-20221102230809606"></p>
<p> ④观察 DistributeServer 控制台，提示 hadoop102 is working </p>
<p> ⑤观察 DistributeClient 控制台，提示 hadoop102 已经上线</p>
<h1 id="第-5-章-ZooKeeper-分布式锁案例"><a href="#第-5-章-ZooKeeper-分布式锁案例" class="headerlink" title="第 5 章 ZooKeeper 分布式锁案例"></a>第 <strong>5</strong> 章 <strong>ZooKeeper</strong> 分布式锁案例</h1><p>​    什么叫做分布式锁呢？</p>
<p>​    比如说”进程 1”在使用该资源的时候，会先去获得锁，”进程 1”获得锁以后会对该资源保持独占，这样其他进程就无法访问该资源，”进程 1”用完该资源以后就将锁释放掉，让其他进程来获得锁，那么通过这个锁机制，我们就能保证了分布式系统中多个进程能够有序的访问该临界资源。那么我们把这个分布式环境下的这个锁叫作分布式锁。</p>
<p><img src="https://image.3001.net/images/20221102/16674017343277.png" alt="image-20221102230842689"></p>
<h2 id="5-1-原生-Zookeeper-实现分布式锁案例"><a href="#5-1-原生-Zookeeper-实现分布式锁案例" class="headerlink" title="5.1 原生 Zookeeper 实现分布式锁案例"></a><strong>5.1</strong> 原生 <strong>Zookeeper</strong> 实现分布式锁案例</h2><p><strong>1）</strong>分布式锁实现 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.lock2;</span><br><span class="line"></span><br><span class="line">import org.apache.zookeeper.*;</span><br><span class="line">import org.apache.zookeeper.data.Stat;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.Collections;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line">public class DistributedLock &#123;</span><br><span class="line">    // zookeeper server 列表</span><br><span class="line">    private String connectString =</span><br><span class="line">            &quot;hadoop102:2181,hadoop103:2181,hadoop104:2181&quot;;</span><br><span class="line">    // 超时时间</span><br><span class="line">    private int sessionTimeout = 2000;</span><br><span class="line">    private ZooKeeper zk;</span><br><span class="line">    private String rootNode = &quot;locks&quot;;</span><br><span class="line">    private String subNode = &quot;seq-&quot;;</span><br><span class="line">    // 当前 client 等待的子节点</span><br><span class="line">    private String waitPath;</span><br><span class="line">    //ZooKeeper 连接</span><br><span class="line">    private CountDownLatch connectLatch = new CountDownLatch(1);</span><br><span class="line"></span><br><span class="line">    //ZooKeeper 节点等待</span><br><span class="line">    private CountDownLatch waitLatch = new CountDownLatch(1);</span><br><span class="line">    // 当前 client 创建的子节点</span><br><span class="line">    private String currentNode;</span><br><span class="line"></span><br><span class="line">    // 和 zk 服务建立连接，并创建根节点</span><br><span class="line">    public DistributedLock() throws IOException,</span><br><span class="line">            InterruptedException, KeeperException &#123;</span><br><span class="line">        zk = new ZooKeeper(connectString, sessionTimeout, new</span><br><span class="line">                Watcher() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    public void process(WatchedEvent event) &#123;</span><br><span class="line">                        // 连接建立时, 打开 latch, 唤醒 wait 在该 latch 上的线程</span><br><span class="line">                        if (event.getState() ==</span><br><span class="line">                                Event.KeeperState.SyncConnected) &#123;</span><br><span class="line">                            connectLatch.countDown();</span><br><span class="line">                        &#125;</span><br><span class="line">                        // 发生了 waitPath 的删除事件</span><br><span class="line">                        if (event.getType() ==</span><br><span class="line">                                Event.EventType.NodeDeleted &amp;&amp; event.getPath().equals(waitPath)) &#123;</span><br><span class="line">                            waitLatch.countDown();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        // 等待连接建立</span><br><span class="line">        connectLatch.await();</span><br><span class="line">        //获取根节点状态</span><br><span class="line">        Stat stat = zk.exists(&quot;/&quot; + rootNode, false);</span><br><span class="line">        //如果根节点不存在，则创建根节点，根节点类型为永久节点</span><br><span class="line">        if (stat == null) &#123;</span><br><span class="line">            System.out.println(&quot;根节点不存在&quot;);</span><br><span class="line">            zk.create(&quot;/&quot; + rootNode, new byte[0],</span><br><span class="line">                    ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 加锁方法</span><br><span class="line">    public void zkLock() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            //在根节点下创建临时顺序节点，返回值为创建的节点路径</span><br><span class="line">            currentNode = zk.create(&quot;/&quot; + rootNode + &quot;/&quot; + subNode,</span><br><span class="line">                    null, ZooDefs.Ids.OPEN_ACL_UNSAFE,</span><br><span class="line">                    CreateMode.EPHEMERAL_SEQUENTIAL);</span><br><span class="line">            // wait 一小会, 让结果更清晰一些</span><br><span class="line">            Thread.sleep(10);</span><br><span class="line">            // 注意, 没有必要监听&quot;/locks&quot;的子节点的变化情况</span><br><span class="line"></span><br><span class="line">            List&lt;String&gt; childrenNodes = zk.getChildren(&quot;/&quot; +</span><br><span class="line">                    rootNode, false);</span><br><span class="line">            // 列表中只有一个子节点, 那肯定就是 currentNode , 说明</span><br><span class="line">            client 获得锁</span><br><span class="line">            if (childrenNodes.size() == 1) &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                //对根节点下的所有临时顺序节点进行从小到大排序</span><br><span class="line">                Collections.sort(childrenNodes);</span><br><span class="line">                //当前节点名称</span><br><span class="line">                String thisNode = currentNode.substring((&quot;/&quot; +</span><br><span class="line">                        rootNode + &quot;/&quot;).length());</span><br><span class="line">                //获取当前节点的位置</span><br><span class="line">                int index = childrenNodes.indexOf(thisNode);</span><br><span class="line">                if (index == -1) &#123;</span><br><span class="line">                    System.out.println(&quot;数据异常&quot;);</span><br><span class="line">                &#125; else if (index == 0) &#123;</span><br><span class="line">                    // index == 0, 说明 thisNode 在列表中最小, 当前</span><br><span class="line">                    client 获得锁</span><br><span class="line">                    return;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    // 获得排名比 currentNode 前 1 位的节点</span><br><span class="line">                    this.waitPath = &quot;/&quot; + rootNode + &quot;/&quot; +</span><br><span class="line">                            childrenNodes.get(index - 1);</span><br><span class="line">                    // 在 waitPath 上注册监听器, 当 waitPath 被删除时,</span><br><span class="line">                    zookeeper 会回调监听器的 process 方法</span><br><span class="line">                    zk.getData(waitPath, true, new Stat());</span><br><span class="line">                    //进入等待锁状态</span><br><span class="line">                    waitLatch.await();</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (KeeperException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 解锁方法</span><br><span class="line">    public void zkUnlock() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            zk.delete(this.currentNode, -1);</span><br><span class="line">        &#125; catch (InterruptedException | KeeperException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2）</strong>分布式锁测试  （</p>
<p>1）创建两个线程 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.lock2;</span><br><span class="line"></span><br><span class="line">import org.apache.zookeeper.KeeperException;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">public class DistributedLockTest &#123;</span><br><span class="line">    public static void main(String[] args) throws</span><br><span class="line">            InterruptedException, IOException, KeeperException &#123;</span><br><span class="line">        // 创建分布式锁 1</span><br><span class="line">        final DistributedLock lock1 = new DistributedLock();</span><br><span class="line">        // 创建分布式锁 2</span><br><span class="line">        final DistributedLock lock2 = new DistributedLock();</span><br><span class="line">        new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                // 获取锁对象</span><br><span class="line">                try &#123;</span><br><span class="line">                    lock1.zkLock();</span><br><span class="line">                    System.out.println(&quot;线程 1 获取锁&quot;);</span><br><span class="line">                    Thread.sleep(5 * 1000);</span><br><span class="line">                    lock1.zkUnlock();</span><br><span class="line">                    System.out.println(&quot;线程 1 释放锁&quot;);</span><br><span class="line">                &#125; catch (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                // 获取锁对象</span><br><span class="line">                try &#123;</span><br><span class="line">                    lock2.zkLock();</span><br><span class="line">                    System.out.println(&quot;线程 2 获取锁&quot;);</span><br><span class="line">                    Thread.sleep(5 * 1000);</span><br><span class="line">                    lock2.zkUnlock();</span><br><span class="line">                    System.out.println(&quot;线程 2 释放锁&quot;);</span><br><span class="line">                &#125; catch (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> （2）观察控制台变化：</p>
<p>线程 1 获取锁</p>
<p>线程 1 释放锁线程 2 获取锁线程 2 释放锁 </p>
<h2 id="5-2-Curator-框架实现分布式锁案例"><a href="#5-2-Curator-框架实现分布式锁案例" class="headerlink" title="5.2 Curator 框架实现分布式锁案例"></a><strong>5.2 Curator</strong> 框架实现分布式锁案例</h2><p><strong>1）</strong>原生的 <strong>Java API</strong> 开发存在的问题</p>
<p>（1）会话连接是异步的，需要自己去处理。比如使用 CountDownLatch</p>
<p>（2）Watch 需要重复注册，不然就不能生效</p>
<p>（3）开发的复杂性还是比较高的 </p>
<p>（4）不支持多节点删除和创建。需要自己去递归 </p>
<p><strong>2）****Curator</strong>是一个专门解决分布式锁的框架，解决了原生 <strong>Java API</strong>开发分布式遇到的问题。 </p>
<p>详情请查看官方文档：<a target="_blank" rel="noopener" href="https://curator.apache.org/index.html[">https://curator.apache.org/index.html[</a> ](<a target="_blank" rel="noopener" href="https://curator.apache.org/index.html">https://curator.apache.org/index.html</a>)</p>
<p><strong>3）****Curator</strong> 案例实操 </p>
<p>（1）添加依赖 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;4.3.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;4.3.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;curator-client&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;4.3.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>（2）代码实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.lock;</span><br><span class="line"></span><br><span class="line">import org.apache.curator.RetryPolicy;</span><br><span class="line">import org.apache.curator.framework.CuratorFramework;</span><br><span class="line">import org.apache.curator.framework.CuratorFrameworkFactory;</span><br><span class="line">import</span><br><span class="line">        org.apache.curator.framework.recipes.locks.InterProcessLock;</span><br><span class="line">import</span><br><span class="line">        org.apache.curator.framework.recipes.locks.InterProcessMutex;</span><br><span class="line">import org.apache.curator.retry.ExponentialBackoffRetry;</span><br><span class="line"></span><br><span class="line">public class CuratorLockTest &#123;</span><br><span class="line">    private String rootNode = &quot;/locks&quot;;</span><br><span class="line"></span><br><span class="line">    // zookeeper server 列表</span><br><span class="line">    private String connectString =</span><br><span class="line">            &quot;hadoop102:2181,hadoop103:2181,hadoop104:2181&quot;;</span><br><span class="line">    // connection 超时时间</span><br><span class="line">    private int connectionTimeout = 2000;</span><br><span class="line">    // session 超时时间</span><br><span class="line">    private int sessionTimeout = 2000;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        new CuratorLockTest().test();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 测试</span><br><span class="line">    private void test() &#123;</span><br><span class="line">        // 创建分布式锁 1</span><br><span class="line">        final InterProcessLock lock1 = new</span><br><span class="line">                InterProcessMutex(getCuratorFramework(), rootNode);</span><br><span class="line">        // 创建分布式锁 2</span><br><span class="line">        final InterProcessLock lock2 = new</span><br><span class="line">                InterProcessMutex(getCuratorFramework(), rootNode);</span><br><span class="line">        new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                // 获取锁对象</span><br><span class="line">                try &#123;</span><br><span class="line">                    lock1.acquire();</span><br><span class="line">                    System.out.println(&quot;线程 1 获取锁&quot;);</span><br><span class="line">                    // 测试锁重入</span><br><span class="line">                    lock1.acquire();</span><br><span class="line">                    System.out.println(&quot;线程 1 再次获取锁&quot;);</span><br><span class="line">                    Thread.sleep(5 * 1000);</span><br><span class="line">                    lock1.release();</span><br><span class="line">                    System.out.println(&quot;线程 1 释放锁&quot;);</span><br><span class="line">                    lock1.release();</span><br><span class="line">                    System.out.println(&quot;线程 1 再次释放锁&quot;);</span><br><span class="line">                &#125; catch (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                // 获取锁对象</span><br><span class="line">                try &#123;</span><br><span class="line">                    lock2.acquire();</span><br><span class="line">                    System.out.println(&quot;线程 2 获取锁&quot;);</span><br><span class="line">                    // 测试锁重入</span><br><span class="line">                    lock2.acquire();</span><br><span class="line"></span><br><span class="line">                    System.out.println(&quot;线程 2 再次获取锁&quot;);</span><br><span class="line">                    Thread.sleep(5 * 1000);</span><br><span class="line">                    lock2.release();</span><br><span class="line">                    System.out.println(&quot;线程 2 释放锁&quot;);</span><br><span class="line">                    lock2.release();</span><br><span class="line">                    System.out.println(&quot;线程 2 再次释放锁&quot;);</span><br><span class="line">                &#125; catch (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 分布式锁初始化</span><br><span class="line">    public CuratorFramework getCuratorFramework() &#123;</span><br><span class="line">        //重试策略，初试时间 3 秒，重试 3 次</span><br><span class="line">        RetryPolicy policy = new ExponentialBackoffRetry(3000, 3);</span><br><span class="line">        //通过工厂创建 Curator</span><br><span class="line">        CuratorFramework client =</span><br><span class="line">                CuratorFrameworkFactory.builder()</span><br><span class="line">                        .connectString(connectString)</span><br><span class="line">                        .connectionTimeoutMs(connectionTimeout)</span><br><span class="line">                        .sessionTimeoutMs(sessionTimeout)</span><br><span class="line">                        .retryPolicy(policy).build();</span><br><span class="line">        //开启连接</span><br><span class="line">        client.start();</span><br><span class="line">        System.out.println(&quot;zookeeper 初始化完成...&quot;);</span><br><span class="line">        return client;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> （2）观察控制台变化：</p>
<p>线程 1 获取锁 </p>
<p>线程 1 再次获取锁 </p>
<p>线程 1 释放锁 </p>
<p>线程 1 再次释放锁 </p>
<p>线程 2 获取锁 </p>
<p>线程 2 再次获取锁</p>
<p> 线程 2 释放锁 </p>
<p>线程 2 再次释放锁</p>
<h1 id="第-6-章-企业面试真题（面试重点）"><a href="#第-6-章-企业面试真题（面试重点）" class="headerlink" title="第 6 章 企业面试真题（面试重点）"></a>第 <strong>6</strong> 章 企业面试真题（面试重点）</h1><h2 id="6-1-选举机制"><a href="#6-1-选举机制" class="headerlink" title="6.1 选举机制"></a><strong>6.1</strong> 选举机制</h2><p> 半数机制，超过半数的投票通过，即通过。</p>
<p>（1）第一次启动选举规则： </p>
<p>​        投票过半数时，服务器 id 大的胜出 </p>
<p>（2）第二次启动选举规则： </p>
<p>​        ①EPOCH 大的直接胜出 </p>
<p>​        ②EPOCH 相同，事务 id 大的胜出 </p>
<p>​        ③事务 id 相同，服务器 id 大的胜出 </p>
<h2 id="6-2-生产集群安装多少-zk-合适？"><a href="#6-2-生产集群安装多少-zk-合适？" class="headerlink" title="6.2 生产集群安装多少 zk 合适？"></a><strong>6.2</strong> 生产集群安装多少 <strong>zk</strong> 合适？</h2><p>安装奇数台。</p>
<p>生产经验： </p>
<ul>
<li><p>  10 台服务器：3 台 zk； </p>
</li>
<li><p>  20 台服务器：5 台 zk； </p>
</li>
<li><p>  100 台服务器：11 台 zk； </p>
</li>
<li><p>  200 台服务器：11 台 zk </p>
</li>
</ul>
<p>服务器台数多：好处，提高可靠性；坏处：提高通信延时 </p>
<h2 id="6-3-常用命令"><a href="#6-3-常用命令" class="headerlink" title="6.3 常用命令"></a><strong>6.3</strong> 常用命令</h2><p>​    ls、get、create、delete</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/hadoop/" rel="tag"># hadoop</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/02/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83/hadoop-3.1.3/06.%E7%94%9F%E4%BA%A7%E8%B0%83%E4%BC%98%E6%89%8B%E5%86%8C-%E9%9B%86%E7%BE%A4%E8%BF%81%E7%A7%BB%EF%BC%88cdh%E9%9B%86%E7%BE%A4%E7%89%88%EF%BC%89/" rel="prev" title="06.生产调优手册-集群迁移（cdh集群版）">
      <i class="fa fa-chevron-left"></i> 06.生产调优手册-集群迁移（cdh集群版）
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E8%B7%AF%E7%BA%BF/%E8%B7%AF%E7%BA%BF/" rel="next" title="学习路线">
      学习路线 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC-1-%E7%AB%A0-Zookeeper-%E5%85%A5%E9%97%A8"><span class="nav-number">1.</span> <span class="nav-text">第 1 章 Zookeeper 入门</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-%E6%A6%82%E8%BF%B0"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-%E7%89%B9%E7%82%B9"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 特点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 数据结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">1.4.</span> <span class="nav-text">1.4 应用场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5-%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80"><span class="nav-number">1.5.</span> <span class="nav-text">1.5 下载地址</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC-2-%E7%AB%A0-Zookeeper-%E6%9C%AC%E5%9C%B0%E5%AE%89%E8%A3%85"><span class="nav-number">2.</span> <span class="nav-text">第 2 章 Zookeeper 本地安装</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E6%9C%AC%E5%9C%B0%E6%A8%A1%E5%BC%8F%E5%AE%89%E8%A3%85"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 本地模式安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%A7%A3%E8%AF%BB"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 配置参数解读</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC-3-%E7%AB%A0-Zookeeper-%E9%9B%86%E7%BE%A4%E6%93%8D%E4%BD%9C"><span class="nav-number">3.</span> <span class="nav-text">第 3 章 Zookeeper 集群操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E9%9B%86%E7%BE%A4%E6%93%8D%E4%BD%9C"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 集群操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-1-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85"><span class="nav-number">3.1.1.</span> <span class="nav-text">3.1.1 集群安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-2-%E9%80%89%E4%B8%BE%E6%9C%BA%E5%88%B6%EF%BC%88%E9%9D%A2%E8%AF%95%E9%87%8D%E7%82%B9%EF%BC%89"><span class="nav-number">3.1.2.</span> <span class="nav-text">3.1.2 选举机制（面试重点）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-3-ZK-%E9%9B%86%E7%BE%A4%E5%90%AF%E5%8A%A8%E5%81%9C%E6%AD%A2%E8%84%9A%E6%9C%AC"><span class="nav-number">3.1.3.</span> <span class="nav-text">3.1.3 ZK 集群启动停止脚本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%93%8D%E4%BD%9C"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 客户端命令行操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-1-%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%AF%AD%E6%B3%95"><span class="nav-number">3.2.1.</span> <span class="nav-text">3.2.1 命令行语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-2-znode-%E8%8A%82%E7%82%B9%E6%95%B0%E6%8D%AE%E4%BF%A1%E6%81%AF"><span class="nav-number">3.2.2.</span> <span class="nav-text">3.2.2 znode 节点数据信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-3-%E8%8A%82%E7%82%B9%E7%B1%BB%E5%9E%8B%EF%BC%88%E6%8C%81%E4%B9%85-%E7%9F%AD%E6%9A%82-%E6%9C%89%E5%BA%8F%E5%8F%B7-%E6%97%A0%E5%BA%8F%E5%8F%B7%EF%BC%89"><span class="nav-number">3.2.3.</span> <span class="nav-text">3.2.3 节点类型（持久**&#x2F;短暂&#x2F;有序号&#x2F;**无序号）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-4-%E7%9B%91%E5%90%AC%E5%99%A8%E5%8E%9F%E7%90%86"><span class="nav-number">3.2.4.</span> <span class="nav-text">3.2.4 监听器原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-5-%E8%8A%82%E7%82%B9%E5%88%A0%E9%99%A4%E4%B8%8E%E6%9F%A5%E7%9C%8B"><span class="nav-number">3.2.5.</span> <span class="nav-text">3.2.5 节点删除与查看</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-%E5%AE%A2%E6%88%B7%E7%AB%AF-API-%E6%93%8D%E4%BD%9C"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 客户端 API 操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-1-IDEA-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">3.3.1.</span> <span class="nav-text">3.3.1 IDEA 环境搭建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-2-%E5%88%9B%E5%BB%BA-ZooKeeper-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">3.3.2.</span> <span class="nav-text">3.3.2 创建 ZooKeeper 客户端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-3-%E5%88%9B%E5%BB%BA%E5%AD%90%E8%8A%82%E7%82%B9"><span class="nav-number">3.3.3.</span> <span class="nav-text">3.3.3 创建子节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-4-%E8%8E%B7%E5%8F%96%E5%AD%90%E8%8A%82%E7%82%B9%E5%B9%B6%E7%9B%91%E5%90%AC%E8%8A%82%E7%82%B9%E5%8F%98%E5%8C%96"><span class="nav-number">3.3.4.</span> <span class="nav-text">3.3.4 获取子节点并监听节点变化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-5-%E5%88%A4%E6%96%AD-Znode-%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="nav-number">3.3.5.</span> <span class="nav-text">3.3.5 判断 Znode 是否存在</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%90%91%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%86%99%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 客户端向服务端写数据流程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC-4-%E7%AB%A0-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%A8%E6%80%81%E4%B8%8A%E4%B8%8B%E7%BA%BF%E7%9B%91%E5%90%AC%E6%A1%88%E4%BE%8B"><span class="nav-number">4.</span> <span class="nav-text">第 4 章 服务器动态上下线监听案例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E9%9C%80%E6%B1%82"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 需求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 需求分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 具体实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-%E6%B5%8B%E8%AF%95"><span class="nav-number">4.4.</span> <span class="nav-text">4.4 测试</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC-5-%E7%AB%A0-ZooKeeper-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E6%A1%88%E4%BE%8B"><span class="nav-number">5.</span> <span class="nav-text">第 5 章 ZooKeeper 分布式锁案例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-%E5%8E%9F%E7%94%9F-Zookeeper-%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E6%A1%88%E4%BE%8B"><span class="nav-number">5.1.</span> <span class="nav-text">5.1 原生 Zookeeper 实现分布式锁案例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-Curator-%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E6%A1%88%E4%BE%8B"><span class="nav-number">5.2.</span> <span class="nav-text">5.2 Curator 框架实现分布式锁案例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC-6-%E7%AB%A0-%E4%BC%81%E4%B8%9A%E9%9D%A2%E8%AF%95%E7%9C%9F%E9%A2%98%EF%BC%88%E9%9D%A2%E8%AF%95%E9%87%8D%E7%82%B9%EF%BC%89"><span class="nav-number">6.</span> <span class="nav-text">第 6 章 企业面试真题（面试重点）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-%E9%80%89%E4%B8%BE%E6%9C%BA%E5%88%B6"><span class="nav-number">6.1.</span> <span class="nav-text">6.1 选举机制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-%E7%94%9F%E4%BA%A7%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E5%A4%9A%E5%B0%91-zk-%E5%90%88%E9%80%82%EF%BC%9F"><span class="nav-number">6.2.</span> <span class="nav-text">6.2 生产集群安装多少 zk 合适？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">6.3.</span> <span class="nav-text">6.3 常用命令</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="希文"
      src="/images/%E5%A4%B4%E5%83%8F.gif">
  <p class="site-author-name" itemprop="name">希文</p>
  <div class="site-description" itemprop="description">日常笔记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yangmour" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yangmour" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:xiwenya999@gmail.com" title="E-Mail → mailto:xiwenya999@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://poc10.cn/" title="http:&#x2F;&#x2F;poc10.cn&#x2F;" rel="noopener" target="_blank">网络安全方面</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">希文</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">809k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">12:15</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
